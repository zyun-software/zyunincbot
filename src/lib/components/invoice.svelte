<script lang="ts">
	import type { InvoiceType } from '$lib/server';

	export let invoice: InvoiceType;
	export let id: string = '';
</script>

<div class="mb-2 p-3 bg-tg-secondary-bg-color rounded">
	<button
		class="w-full text-left"
		on:click={() => {
			id = invoice.id === id ? '' : invoice.id;
		}}
	>
		<table class="table-auto w-full">
			<tbody>
				<tr>
					<td>üÜî&nbsp;–ö–æ–¥</td>
					<td>{invoice.id}</td>
				</tr>
				<tr>
					<td>üìã&nbsp;–í–∏–ø–∏—Å–∞–≤</td>
					<td>{invoice.name}</td>
				</tr>
				<tr>
					<td>üí∞&nbsp;–°—É–º–∞</td>
					<td>
						{invoice.items.reduce((accumulator, currentItem) => {
							const product = currentItem.price * currentItem.quantity;
							return accumulator + product;
						}, 0)} ‚Ç¥
					</td>
				</tr>
				<tr>
					<td>{invoice.transaction_id === null ? '‚è≥' : '‚úÖ'}&nbsp;–°—Ç–∞—Ç—É—Å</td>
					<td>{invoice.transaction_id === null ? '–û—á—ñ–∫—É—î—Ç—å—Å—è –æ–ø–ª–∞—Ç–∞' : '–û–ø–ª–∞—á–µ–Ω–æ'}</td>
				</tr>
				{#if invoice.transaction_id !== null}
					<tr>
						<td>üí∏&nbsp;–û–ø–ª–∞—Ç–∏–≤</td>
						<td>{invoice.payer_name}</td>
					</tr>
				{/if}
			</tbody>
		</table>
	</button>
	{#if id === invoice.id}
		{#each invoice.items as { name, price, quantity, description }}
			<div class="p-3 bg-tg-bg-color rounded mt-2">
				<table class="table-auto w-full">
					<tbody>
						<tr>
							<td class="align-top">üè∑Ô∏è&nbsp;–ù–∞–∑–≤–∞</td>
							<td>{name}</td>
						</tr>
						<tr>
							<td>üí∞&nbsp;–¶—ñ–Ω–∞</td>
							<td>{price} ‚Ç¥</td>
						</tr>
						<tr>
							<td>üî¢&nbsp;–ö—ñ–ª—å–∫—ñ—Å—Ç—å</td>
							<td>{quantity}</td>
						</tr>
						<tr>
							<td class="align-top">üìÑ&nbsp;–û–ø–∏—Å</td>
							<td>{description}</td>
						</tr>
					</tbody>
				</table>
			</div>
		{/each}
	{/if}
</div>
